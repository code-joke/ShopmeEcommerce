<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments :: page_head(${pageTitle}, 'none')"></head>
<body>
	<div class="container-fluid">
			<!-- thanh công cụ -->
		<div th:replace="navigation :: menu"></div>
		&nbsp;
		
		<div class="text-title">
			<h4>Đơn hàng | [[${pageTitle}]]</h4>&nbsp;&nbsp;
		</div>
		
		<form th:action="@{/orders/save}" method = "post" style=" margin: 0 auto"
			enctype="multipart/form-data"
			th:object="${order}">
			<input type="hidden" th:field="*{id}">
			<div class="p-3">
				<div class="form-group row">
					<label class="col-sm-2 col-form-label">Khách hàng: </label>
					<label class="col-sm-4 col-form-label">
					[[${order.customerName}]]
					</label>
				</div>
				
				<div class="form-group row">
					<label class="col-sm-2 col-form-label">Ngày đặt: </label>
					<label class="col-sm-2 col-form-label" th:text="${#dates.format(order.orderTime, 'dd-MM-yyyy HH:mm:ss')}">
					</label>
				</div>
				
				<div class="form-group row">
					<label class="col-sm-2 col-form-label required">Số điện thoại:</label>
					<div class="col-sm-2">
						<input type="text" class="form-control" th:field="*{phone}" required minlength="10" maxlength="15" placeholder="Nhập số điện thoại">
					</div>
				</div>
				
				<div class="form-group row">
					<label class="col-sm-2 col-form-label required">E-mail:</label>
					<div class="col-sm-3">
						<input type="email" class="form-control" th:field="*{email}" required minlength="8" maxlength="128" placeholder="Nhập email">
					</div>
				</div>
				
				<div class="form-group row">
					<label class="col-sm-2 col-form-label required">Giao đến:</label>
					<div class="col-sm-4">
						<input type="text" class="form-control" th:field="*{address}" required minlength="2" maxlength="500" placeholder="Nhập email">
					</div>
				</div>
				
				<div class="form-group row">
					<label class="col-sm-2 col-form-label">Ghi chú:</label>
					<div class="col-sm-4">
						<textarea th:field="*{note}" class="form-control" maxlength="500"></textarea>
					</div>
				</div>
				<br>
				<a class="btn btn-danger" th:href="@{'/'}">XÁC THỰC ĐƠN HÀNG</a>
				<hr>
				<h6>Chi tiết đơn hàng</h6>
				<table class="table table-bordered table-striped table-hover table-responsive-xl">
				<thead class="thead-dark">
					<tr>
						<th>STT</th>
						<th>TÊN SẢN PHẨM</th>
						<th>GIÁ</th>
						<th class="text-center">SỐ LƯỢNG</th>
						<th>THÀNH TIỀN</th>
						<th></th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="item, state : ${order.orderDetails}">
						<td>[[${state.count}]]</td>
						<td>
							[[${item.product.name}]]
							<br>
							<small>Kho: [[${item.product.quantityInStock}]]</small>
						</td>
						<td>
						[[${#numbers.formatDecimal(item.price, 0, 'POINT', 0, 'POINT')}]] ₫</td>
						<td>
							<nav>
							<ul class="pagination ml-5">
								<li class="page-item">
									<a class="page-link minusButton" th:href="@{'/minus_one/' + ${productId}}"><small><i class="fas fa-minus"></i></small></a>
								</li>
								<li class="page-item">
									<input type="text" th:value="${item.quantity}" class="form-control text-center"
										style="max-width: 55px"
										th:id="'quantity' + ${item.product.id}"/>
								</li>
								<li class="page-item">
									<a class="page-link plusButton" th:href="@{'/plus_one/' + ${productId}}"><i class="fas fa-plus"></i></a>
								</li>
							</ul>
							</nav>
						</td>
						<td>[[${#numbers.formatDecimal(item.subTotal, 0, 'POINT', 0, 'POINT')}]] ₫</td>
						<td class=""><div th:replace="fragments :: delete('đơn hàng này', ${order.id}, '/orders/delete/' + ${order.id}, true)"></div></td>
					</tr>
				</tbody>
			</table>
			</div>
			
			<div class="text-center">
					<input type="submit" value="Lưu" class="btn btn-primary m-3">
					<input type="button" value="Hủy bỏ" class="btn btn-secondary" id="buttonCancel">
			</div>
		</form>
			
		
		<div th:replace="modal_fragments :: modal_dialog"></div>
		
		&nbsp;&nbsp;
		<div th:replace="fragments :: footer"></div>
		
	</div>
<script type="text/javascript">
	moduleURL = "[[@{/users}]]";
	
	function checkEmailUnique(form) {
		url = "[[@{/users/check_email}]]";
		userEmail = $("#email").val();
		userId = $("#id").val();
		csrfValue = $("input[name='_csrf']").val();
		params = {id: userId, email: userEmail, _csrf: csrfValue};
		
			
		$.post(url, params, function(response) {
			if(response == "OK") {
				form.submit();
			} else if (response == "Duplicated") {
				showWarningModal("Email đã tồn tại: " + userEmail);
			} else {
				showErrorModal("Máy chủ hiện không phản hồi");
			}
		}).fail(function() {
				showErrorModal("Không thể kết nối đến máy chủ");
		});
		
		return false;
	}
	
</script>
<script th:src="@{/js/common_form.js}"></script>
</body>
</html>